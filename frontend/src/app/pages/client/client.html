<!-- ============================================================================ -->
<!-- P√ÅGINA: CLIENT - TecnoMayores -->
<!-- ============================================================================ -->
<!-- √Årea de usuario: lecciones, progreso y ayuda -->
<!-- ClienteFase2: Usa servicios para datos y notificaciones -->

<main class="client">
  <div class="client__container">

    <!-- ================================================================== -->
    <!-- ALERTAS -->
    <!-- ================================================================== -->

    <!-- Alerta de bienvenida -->
    <app-alert
      *ngIf="showWelcomeAlert"
      type="info"
      message="¬°Bienvenido a TecnoMayores!"
      description="Explora nuestras lecciones y aprende a usar la tecnolog√≠a a tu ritmo. Prueba los botones de notificaci√≥n para ver el sistema de toasts."
      [closeable]="true"
      (close)="closeWelcomeAlert()"
    ></app-alert>

    <!-- ================================================================== -->
    <!-- HEADER DE LA P√ÅGINA -->
    <!-- ================================================================== -->
    <header class="client__header">
      <div class="client__header-content">
        <h1 class="client__title">Mi √Årea de Aprendizaje</h1>
        <p class="client__subtitle">
          Aprende a usar la tecnolog√≠a con lecciones sencillas y pr√°cticas
        </p>
      </div>

      <div class="client__header-actions">
        <app-tooltip text="Crea una cuenta nueva" position="bottom">
          <app-button variant="secondary" size="lg" (click)="openRegisterModal()">
            Registrarse
          </app-button>
        </app-tooltip>
        <app-tooltip text="Guarda tu progreso iniciando sesi√≥n" position="bottom">
          <app-button variant="primary" size="lg" (click)="openLoginModal()">
            Iniciar Sesi√≥n
          </app-button>
        </app-tooltip>
      </div>
    </header>

    <!-- ================================================================== -->
    <!-- SISTEMA DE NOTIFICACIONES - Demo ClienteFase2 -->
    <!-- ================================================================== -->
    <section class="client__notifications-demo">
      <h2 class="client__section-title">üîî Sistema de Notificaciones</h2>
      <p class="client__section-desc">
        Prueba los diferentes tipos de notificaciones (toasts) - ClienteFase2
      </p>
      <div class="client__toast-buttons">
        <app-button variant="primary" size="sm" (click)="showSuccessToast()">
          ‚úì √âxito
        </app-button>
        <app-button variant="danger" size="sm" (click)="showErrorToast()">
          ‚úï Error
        </app-button>
        <app-button variant="secondary" size="sm" (click)="showInfoToast()">
          ‚Ñπ Info
        </app-button>
        <app-button variant="ghost" size="sm" (click)="showWarningToast()">
          ‚ö† Aviso
        </app-button>
      </div>
    </section>

    <!-- ================================================================== -->
    <!-- BARRA DE PROGRESO -->
    <!-- ================================================================== -->
    <section class="client__progress-section">
      <div class="client__progress-info">
        <span class="client__progress-label">Tu progreso:</span>
        <span class="client__progress-stats">
          {{ progress.completed }} de {{ progress.total }} lecciones completadas
        </span>
      </div>
      <div class="client__progress-bar">
        <div
          class="client__progress-fill"
          [style.width.%]="progress.percentage"
        ></div>
      </div>
      <span class="client__progress-percentage">{{ progress.percentage }}%</span>
    </section>

    <!-- ================================================================== -->
    <!-- BUSCADOR -->
    <!-- ================================================================== -->
    <section class="client__search-section">
      <div class="client__search-wrapper">
        <span class="client__search-icon">üîç</span>
        <input
          #searchInput
          type="text"
          class="client__search-input"
          placeholder="Buscar lecciones..."
          [value]="searchQuery"
          (keyup)="onSearchKeyup($event)"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
          aria-label="Buscar lecciones"
        />
        <app-tooltip text="Escribe para filtrar las lecciones" position="right">
          <button
            class="client__search-help"
            type="button"
            aria-label="Ayuda de b√∫squeda"
          >
            ?
          </button>
        </app-tooltip>
      </div>
    </section>

    <!-- ================================================================== -->
    <!-- TABS - Navegaci√≥n entre secciones -->
    <!-- ================================================================== -->
    <section class="client__tabs-section">
      <app-tabs
        [tabs]="userTabs"
        [activeTabId]="activeTabId"
        variant="pills"
        (tabChange)="onTabChange($event)"
      ></app-tabs>

      <!-- Contenido de las Tabs -->
      <div class="client__tab-content">

        <!-- Mensaje cuando no hay resultados -->
        <div *ngIf="filteredLessons.length === 0" class="client__empty-state">
          <span class="client__empty-icon">üì≠</span>
          <p *ngIf="activeTabId === 'todas'">No se encontraron lecciones con "{{ searchQuery }}"</p>
          <p *ngIf="activeTabId === 'progreso'">A√∫n no has completado ninguna lecci√≥n. ¬°Empieza hoy!</p>
          <p *ngIf="activeTabId === 'favoritos'">No tienes lecciones favoritas. Pulsa la ‚≠ê para a√±adir.</p>
        </div>

        <!-- Grid de Lecciones -->
        <div class="client__lessons-grid" *ngIf="filteredLessons.length > 0">
          <article
            *ngFor="let lesson of filteredLessons"
            class="client__lesson-card"
            [class.client__lesson-card--done]="lesson.completed"
            (click)="openLessonModal(lesson)"
            (keyup.enter)="openLessonModal(lesson)"
            tabindex="0"
            role="button"
            [attr.aria-label]="'Abrir lecci√≥n: ' + lesson.title"
          >
            <!-- Imagen de la lecci√≥n -->
            <div class="client__lesson-image">
              <img [src]="lesson.image" [alt]="lesson.title" />
              <span
                *ngIf="lesson.completed"
                class="client__lesson-badge"
                aria-label="Completada"
              >
                ‚úì
              </span>
            </div>

            <!-- Contenido de la card -->
            <div class="client__lesson-content">
              <div class="client__lesson-header">
                <span class="client__lesson-category">{{ lesson.category }}</span>
                <app-tooltip
                  [text]="lesson.favorite ? 'Quitar de favoritos' : 'A√±adir a favoritos'"
                  position="top"
                >
                  <button
                    class="client__favorite-btn"
                    [class.client__favorite-btn--active]="lesson.favorite"
                    (click)="toggleFavorite(lesson, $event)"
                    [attr.aria-pressed]="lesson.favorite"
                    aria-label="Favorito"
                  >
                    {{ lesson.favorite ? '‚≠ê' : '‚òÜ' }}
                  </button>
                </app-tooltip>
              </div>

              <h3 class="client__lesson-title">{{ lesson.title }}</h3>
              <p class="client__lesson-description">{{ lesson.description }}</p>

              <div class="client__lesson-footer">
                <span class="client__lesson-duration">‚è±Ô∏è {{ lesson.duration }} min</span>
                <span class="client__lesson-difficulty">{{ getDifficultyLabel(lesson.difficulty) }}</span>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- ================================================================== -->
    <!-- FAQ - Preguntas Frecuentes con Accordion -->
    <!-- ================================================================== -->
    <section class="client__faq-section">
      <h2 class="client__section-title">‚ùì Preguntas Frecuentes</h2>
      <p class="client__section-desc">
        Respuestas a las dudas m√°s comunes. Pulsa en una pregunta para ver la respuesta.
      </p>

      <app-accordion
        [items]="faqItems"
        [allowMultiple]="false"
      ></app-accordion>
    </section>

    <!-- ================================================================== -->
    <!-- MODAL - Detalle de Lecci√≥n -->
    <!-- ================================================================== -->
    <app-modal
      [isOpen]="showLessonModal"
      [title]="selectedLesson?.title || 'Lecci√≥n'"
      size="md"
      (closed)="closeLessonModal()"
    >
      <div class="client__lesson-modal" *ngIf="selectedLesson">
        <img
          [src]="selectedLesson.image"
          [alt]="selectedLesson.title"
          class="client__lesson-modal-image"
        />

        <div class="client__lesson-modal-meta">
          <span class="client__lesson-modal-category">{{ selectedLesson.category }}</span>
          <span class="client__lesson-modal-duration">‚è±Ô∏è {{ selectedLesson.duration }} minutos</span>
          <span class="client__lesson-modal-difficulty">{{ getDifficultyLabel(selectedLesson.difficulty) }}</span>
        </div>

        <p class="client__lesson-modal-desc">{{ selectedLesson.description }}</p>

        <div class="client__lesson-modal-info">
          <h4>¬øQu√© aprender√°s?</h4>
          <ul>
            <li>Paso a paso con explicaciones claras</li>
            <li>Im√°genes de ejemplo para seguir f√°cilmente</li>
            <li>Consejos pr√°cticos para recordar</li>
          </ul>
        </div>
      </div>

      <div modal-footer>
        <app-button variant="ghost" (click)="closeLessonModal()">
          Cerrar
        </app-button>
        <!-- Bot√≥n con loading local - ClienteFase2 -->
        <app-button
          *ngIf="selectedLesson && !selectedLesson.completed"
          variant="primary"
          [disabled]="isSavingLesson()"
          (click)="completeLesson(selectedLesson)"
        >
          {{ isSavingLesson() ? 'Guardando...' : 'Marcar como Completada ‚úì' }}
        </app-button>
        <app-button
          *ngIf="selectedLesson?.completed"
          variant="secondary"
          (click)="closeLessonModal()"
        >
          Repasar Lecci√≥n
        </app-button>
      </div>
    </app-modal>

    <!-- ================================================================== -->
    <!-- MODAL - Login -->
    <!-- ================================================================== -->
    <app-modal
      [isOpen]="showLoginModal"
      title="Iniciar Sesi√≥n"
      size="sm"
      (closed)="closeLoginModal()"
    >
      <div class="client__login-modal">
        <p class="client__login-info">
          Inicia sesi√≥n para guardar tu progreso y acceder desde cualquier dispositivo.
        </p>

        <app-login-form
          (loginSubmit)="onLoginSubmit($event)"
        ></app-login-form>
      </div>
    </app-modal>

    <!-- ================================================================== -->
    <!-- MODAL - Registro (ClienteFase3) -->
    <!-- ================================================================== -->
    <app-modal
      [isOpen]="showRegisterModal"
      title="Crear Cuenta Nueva"
      size="lg"
      (closed)="closeRegisterModal()"
    >
      <div class="client__register-modal">
        <p class="client__register-info">
          Completa el formulario para crear tu cuenta en TecnoMayores.
          Los campos marcados con <span class="required">*</span> son obligatorios.
        </p>

        <app-register-form
          (formSubmit)="onRegisterSubmit($event)"
        ></app-register-form>
      </div>
    </app-modal>

  </div>
</main>

